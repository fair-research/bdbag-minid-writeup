\documentclass[11pt]{article}

\input preamble

%\newdimen\tlx
%\newdimen\tlx
%\newdimen\brx
%\newdimen\bry

\title{BDBags and Minids:\\A Framework for Universal FAIRness}
\author{}
\date{}

\begin{document}
\maketitle


\section{Introduction}

Big data from high throughput experiments and other sources create exciting new opportunities for biomedical discovery. 
They also present considerable challenges %for researchers and indeed for the research process, 
due to the difficulties inherent in manipulating large data volumes and capturing the resulting analysis workflows in reproducible forms.
In particular, despite broad acceptance of the importance of ensuring that data are
Findable, Accessible, Interoperable, and Reusable (FAIR)~\cite{wilkinson16},
many big data languish unused. 

In response, the NIH BD2K Big Data for Discovery Science (BDDS) center~\cite{toga15}
has developed two powerful new constructs that simplify the realization of FAIRness in 
complex big data applications: Big Data Bags (BDBags) for data exchange and 
minimal identifiers (Minids) as persistent identifiers for intermediate data products.
Together, and in conjunction with other tools developed by BDDS team members and partners,
these constructs allow biomedical data to be captured in reusable forms that are accessible via persistent identifiers. 
The result is that big data need not be hard to find, access, nor (re)use. 
%Modern tools can be used to automate routine but complex tasks, capture analysis algorithms in understandable and reusable forms, and harness fast networks and powerful cloud computers to process data rapidly without sacrificing usability or reproducibility. 

\section{BDBags and Minids: Why, What, and How}

%\vspace{1ex}
%
%\noindent
%\textbf{The problem.}
Big data science requires mechanisms for describing, referring to,
and exchanging large  and complex datasets that may comprise many directories and files (elements).
The following five requirements are key:
%Five key requirements are~\cite{chard16}:
\begin{enumerate}
\item
\textbf{enumeration}: explicit enumeration of a dataset's elements, so that
subsequent additions or deletions can be detected; 
\item
\textbf{fixity}: enable verification of dataset contents, 
so that data consumers can detect errors in data transmission or modifications to data elements; 
\item
\textbf{description}: provide interoperable methods for tracking the attributes (metadata) and origins (provenance) of dataset contents; 
\item
\textbf{distribution}: allow a dataset to contain elements from more than one location; and
\item
\textbf{identification}: provide a reliable and concise way of referring to datasets for purposes of collaboration, publication, and citation.
\end{enumerate}

%\begin{figure}
%\begin{tabbing}
%aa\=aa\=aa\=aaaaaaaaaaaaaaaaaaaaaaaa\=aa\=aa\=\kill
%{\tt \small examplebag/} \>\>\>\> Top level name\\
%\> \texttt{\textbf{\small bag-info.txt}} \>\>\>  Metadata for the bag\\
%\> {\tt \small bagit.txt} \>\>\>  BagIt version and encoding information \\
%\>  {\tt \small data/} \>\>\>  The BDBag's contents:\\
%\>\> {\tt \small mydirectory/} \>\>\> User directory \\
%\>\>\>  {\tt \small file1} \>\>\>A first user file \\
%\>\>\>  {\tt \small file2}\>\>\>  A second user file \\
%\>  \texttt{\textbf{\small fetch.txt}} \>\>\>  How to fetch missing elements \\
%\>  {\tt \small manifest-md5.txt} \>\>\> MD5 checksums for data files\\
%\>  {\tt \small manifest-sha256.txt} \>\>\> SHA checksums for data files\\
%\>  {\tt \small metadata/} \>\>\>  Tag directory for Research Object metadata\\
%\>\>  \texttt{\textbf{\small manifest.json}}\>\> \> Research Object metadata as JSON-LD\\
%\>  \texttt{\textbf{\small tagmanifest-md5.txt}} \>\>\>  MD5 checksum for tags\\
%\>  \texttt{\textbf{\small tagmanifest-sha256.txt}} \>\>\> SHA checksum for tags
%\end{tabbing}
%\caption{An example BDBag, with contents in the \texttt{data} folder, 
%description in the \texttt{metadata} folder, and other elements providing data required to
%fetch remote elements (\texttt{fetch.txt}) and validate its components.\label{fig:2}}
%\end{figure}

Surprisingly, we determined early in BDDS that no existing technology addressed these requirements.
Thus we made the development of suitable mechanisms a major focus of the project.
The result is two important new technologies:
the Big Data Bag (BDBag) for defining a dataset and its contents by enumerating and describing its elements, 
regardless of their location (\emph{enumeration}, \emph{fixity}, \emph{description}, \emph{distribution})
%the Research Object (RO)~\cite{bechhofer2013linked} to characterize a dataset and its contents with arbitrary levels of detail, regardless of their location (description);
and the Minid to uniquely identify a dataset and, if desired, its constituent elements, 
regardless of their location (\emph{identify}, \emph{fixity}).
We define and implement each in ways that permit their easy integration into a wide variety of
applications and workflows, without deployment of complex software on researcher computers.

\subsection{Big Data Bags for exchange of large and complex data}

We designed the BDBag exchange format and associated tools~\cite{chard16} to meet the \emph{enumeration}, \emph{fixity}, \emph{description}, and \emph{distribution} requirements identified above
and thus to provide a robust mechanism for exchanging large and complex data collections.

Rather than start from scratch, we build on and extend an Internet Engineering Task Force (IETF) specification,
BagIt~\cite{Kunze2015}.
%To give a flavor of the BDBag specification.
%we show an example in Fig~\ref{fig:2}. 
From BagIt, we take a simple structure that represents a dataset's contents as directories and files contained within a data directory,
with other elements providing checksum and metadata information required to verify and interpret the data. 
On this foundation, we add features that allow for the encoding of references to remotely accessible data, with the information required to retrieve those data provided in a \texttt{fetch.txt} file as a (URL, LENGTH, FILENAME) triple, and the specification, via the use of Research Object~\cite{bechhofer2013linked} mechanisms, 
of the type and provenance of BDBag contents.  
The ability to reference remote data also allows the definition of data collections that specific individuals may not have immediate permission to access, 
as when access to data elements is restricted by data use agreements.
We then developed a comprehensive suite of tools for creating BDBags, for
materialize the data in a BDBag in a standard way, for capturing metadata, 
and for verifying contents based on checksums of individual data and metadata items.

In summary, our contributions span four areas:
\begin{enumerate}
\item
We designed, and obtained broad community support for, BagIt extensions that allow for big scientific data.
These extensions include support for
``holey" bags (i.e., bags that contain references to remote data)
and mechanisms for associating descriptions of bag contents in the form of a Research Object~\cite{bechhofer2013linked}.

\item
We developed high-quality open source implementations of tools for creating BDBags, 
%along with associated file references and RO description, 
for resolving files that are represented via remote references, for validating
bags, for creating bags of bags, and other purposes.

\item
We integrated these mechanisms with a range of other tools, 
from Minids and Globus to ENCODE and Galaxy 
to provide an end-to-end solution to the problem of organizing and sharing big data. 

\item
We developed compelling example applications that demonstrate the value of BDBag capabilities.

\end{enumerate}

%These mechanisms enable the exchange of large, self-describing datasets without copying large amounts of data.
%Indeed, a ``holey'' BDBag that a hundreds of bytes in size can provide a complete description of 

The result is an entirely new capability that makes it possible to
capture in a concise document a consistent, self-describing, integrity-verifiable description of many quantities of data.
\emph{A BDBag of just a few hundred bytes may contain references to many terabytes, and 
can be stored, referenced in a paper, and exchanged with other researchers or tools
and then resolved at any point to access the referenced data.}

%(a ``holey'' BDBag that contains only references, not data, may be just a few hundreds of bytes in size

%The BDBag specification adopts the \textbf{Research Object} (RO) framework to associate attribution and provenance information, and structured and unstructured annotations describing individual resources, with the data contained in a BDBag.
%A BDBag's metadata directory contains annotations and the RO manifest.json in JSON-LD format~\cite{JSONLD}: see Fig~\ref{fig:2}.

%\begin{figure}
%\centering
%\fbox{\includegraphics[width=0.8\textwidth,trim=0.2in 1.6in 3.2in 0.3in,clip]{figs/LandingPage-new.pdf}}
%\caption{A Minid landing page for a BDBag generated by the \texttt{encode2bag} tool,
%showing the associated metadata, including locations (in this case, just one).\label{fig:3}}
%\end{figure}

\subsection{Minimal identifiers}

We designed the minimal viable identifier (\textbf{Minid})~\cite{chard16} to meet researcher needs
for robustly naming the many datasets that may be created in the course of their work, 
so that they can uniquely reference and locate data,
and share and exchange names (rather than an entire dataset) 
while being able to ensure that a dataset's contents are unchanged.
The Digital Object Identifiers (DOIs) that are sometimes used for this purpose
are heavyweight constructs designed for naming resources such as scholarly articles
that are created only rarely.
Minids, by contrast, are lightweight, low-cost identifiers designed to enable frequent creation;
they can be easily created, resolved, and used in their millions. 

Minids  take the form \texttt{minid:[suffix]}, where  the suffix is a unique sequence of characters
and can be resolved, for example via \texttt{\href{https://n2t.net}{n2t.net}},
so that visiting
\texttt{\href{https://n2t.net/minid:b9j01d}{https://n2t.net/minid:b9j01d}} 
redirects the browser to the landing page for the
object with identifier \texttt{minid:b9j01d}.
Importantly, a Minid can link to more than one location for the referenced data.
%allowing for data replication.
%For example, a Minid may reference 
for example, one copy in the source repository, 
additional copies in different cloud object stores, and another on a local file system.
Because a Minid includes a checksum of the content, 
we can ensure that whatever copy is used, it contains the correct and intended content.
The consumer can then determine which copy of the data is ``best'' for their purpose.
%and the responsibility of the Minid creator to interact with the landing page service to register new copies.
%The GET methods for the landing page support HTTP content negotiation;
%results may be returned in human-readable (HTML) or machine-readable (JSON) form.

As with BDBags, we created the Minid construct via the artful combination of existing and new capabilities.
We combine ARKs as names, 
\texttt{\href{https://identifiers.org}{identifiers.org}} and \texttt{\href{https://n2t.net}{n2t.net}} for name resolution,
and the Amazon cloud to host the Minid service that we have created. 


\subsection{Using BDBags and Minids together} 

While Minids and BDBags can be used independently, they can be used together to powerful effect. 
We can create a Minid for a BDBag, 
allowing us to uniquely identify the BDBag instance and providing a repeatable method for referring to the BDBag. 
A Minid can be used as the URL for a remote file reference within a BDBag's \texttt{fetch.txt} file,
in place of a direct URL to a file storage location.  
The BDBag tooling knows how to resolve such a Minid reference
through the landing page to a copy of the BDBag data
for materialization into the complete data set.  
%We leverage both of these combinations of Minids and bags in the TFBS workflows.



\section{Using the BDBag and Minid software}

The BDBag client tools are maintained on GitHub at \smallurl{https://github.com/ini-bdds/bdbag} and the 
Minid client tools at \smallurl{https://github.com/ini-bdds/minid}.
Each can be used in two different ways: from the command line or from Python.

\subsection{BDBag and Minid command line tools} 

The BDBag and Minid command line tools are each registered with PyPi, 
so we install them as follows:
\vspace{-1ex}
\begin{tabbing}
aaaa\=\kill
\>\code{pip install bdbag}\\
\>\code{pip install minid}
\end{tabbing}

\noindent
The \code{bdbag} tool can then be used to perform a wide variety of tasks, such as the following.
\begin{itemize}
\item
We can create a BDBag containing the data in \texttt{my-data/}:
\vspace{-2ex}
\begin{tabbing}
aaaa\=\kill
\>\code{bdbag ./my-data/}
\end{tabbing}

\item
We can add references to the URIs listed in \texttt{my-manifest.json}, to create a holey bag:
\vspace{-2ex}
\begin{tabbing}
aaaa\=\kill
\>\code{bdbag ./my-data/ --update --remote-file-manifest ./my-manifest.json}
\end{tabbing}

\item
Validate the bag, and create an archive file for sharing
\vspace{-2ex}
\begin{tabbing}
aaaa\=\kill
\>\code{bdbag ./my-data/ --validate fast --validate-profile --archive tgz}
\end{tabbing}

\end{itemize}

\noindent
Similarly, the \code{minid} tool can be used to do a wide variety of things, including:

\begin{itemize}
\item
Create a new identifier:
\vspace{-2ex}
\begin{tabbing}
aaaa\=\kill
\>\code{minid --register --title "My data" my-file --locations my-locn1}
\end{tabbing}

\item
Retrieve metadata about an identifier:
\vspace{-2ex}
\begin{tabbing}
aaaa\=\kill
\>\code{minid minid:b9j01d}\footnote{Note that this does NOT work.}
\end{tabbing}
\end{itemize}
 

\subsection{BDBag and Minid Python APIs} 

Programmers can integrate BDBag and Minid functionality into their applications by using
Python APIs, as documented at \smallurl{https://github.com/ini-bdds/bdbag/blob/master/doc/api.md}.
We have used these APIs are used to implement the command line tools just described,
the \texttt{encode2bag} tool described next, and other applications listed in the rest of this section. 


\subsection{Tools that use BDBag and Minid APIs}

We have developed a range of additional tools that provide useful functionality to users.
These tools also serve as examples of how to integrate BDBag and Minid
capabilities into applications.

\subsubsection{The \texttt{bagofbags} tool}

This application creates a bag that itself contains bags.
It is used, for example, in the transcription factor
binding site study~\cite{madduri2018reproducible}.
See \smallurl{https://github.com/ini-bdds/bdbag/tree/master/examples/bagofbags}.
Figure~\ref{fig:bob}, from the \texttt{bagofbags} documentation, illustrates its use.

\begin{figure}
\centering
\includegraphics[width=0.8\textwidth]{figs/MetaBags.png}
\caption{At top, an example use of the \texttt{bagofbags} tool; below, an illustration of the BDBag created, which contains the usual files that are to be found in a BDBag, with the \texttt{fetch.txt} file containing the Minids that can be used to fetch their contents and the \texttt{data/manifest.json} containing descriptive metadata. In addition, the \texttt{data/README} file contains background information.\label{fig:bob}}
\end{figure}

\subsubsection{The Data Concierge tool}

This service takes a set of Search results, creates a BDBag, and tracks the location with a Minid.
See \smallurl{https://github.com/ini-bdds/data-concierge}.


\subsubsection{The \texttt{encode2bag} tool}

We use a genomics example to illustrate how the BDBag and Minid tools can be used to reduce
barriers to data sharing and reproducibility.
The Encyclopedia of DNA Elements (ENCODE) consortium operates a database that aims to provide a
comprehensive parts list of functional elements in the human genome.
ENCODE provides a web portal that a researcher can use to query this database,
using menus to specify parameters such as assay, biosample, and genomic annotations.
The result is a set of data URLs,
which must be downloaded individually and unfortunately do not come with associated metadata or context.
Researchers often resort to building shell scripts to download and store the raw datasets.
These manual data retrieval and management steps can be error-prone,
time consuming, and difficult to reproduce.
Researchers must manually save results to record data provenance (posing the same query to the database at different
times may give different results)
and the only way to validate that downloaded files have not been corrupted is to download them again.
In other words, the ENCODE portal is not particularly supportive of FAIR research.

We thus used BDBag, Minid, and Globus tools to create a lightweight command line utility and web service, \texttt{encode2bag}.
A researcher can use either the web interface or the command line interface to
either enter an ENCODE query or upload an ENCODE metadata file describing a collection of datasets.
They can then access the corresponding data, \emph{plus associated metadata and checksums}, as a BDBag.
Selecting the ``Create BDBag'' button triggers the creation of a $\sim$100 kilobyte BDBag that encapsulates references to the files in question, metadata associated with those files, the query used to identify the data, and the checksums required to validate the files and metadata.
The BDBag is stored in AWS Simple Storage Service (S3) cloud storage from where it can be accessed for purposes of sharing, reproducibility, or validation.
Because this BDBag contains references to data, rather the data themselves, it captures the entire response to the query in a small (hundreds of kilobytes) form that can be easily downloaded, moved, and shared.
When needed, all, or a subset of, the files named within the BDBag's \texttt{fetch.txt} file can be downloaded
(using BDBag tools), while ensuring that their contents match those of the original query.

To further streamline access to query results, \texttt{encode2bag} assigns a Minid for each BDBag that it creates,
so as to provide for unambiguous naming and identification of research data products that are used for data provenance.
The Minid can be passed between services as a concise reference to the BDBag.

The \texttt{encode2bag} service proved vital when creating a reproducible version~\cite{madduri2018reproducible}
of a workflow developed by Funk et al.~\cite{funk18} to use ENCODE data to identify candidate
transcription factor binding sites. 
Funk et al.\ used
 \texttt{encode2bag} to create BDBags for each of 27 tissue types, each with its own Minid.
These 27 BDBags contain references to a total of 2.4 TB of ENCODE data;
references that can be followed at any time to access the associated data.
A separate BDBag (a ``bag of bags") contains references to each of the 27 tissue type bags. 

The \texttt{encode2bag} service and client side tool are available on GitHub at
\smallurl{https://github.com/ini-bdds/encode2bag} and 
\smallurl{https://github.com/ini-bdds/encode2bag-service}.



\section{Evaluating Impact}

These tools work naturally with other tools
Globus cloud services for authentication and data transfer; 
and the Galaxy-based Globus Genomics and Docker containers for reproducible cloud-based computations. 

Reference Trena paper~\cite{funk18} and reproducible version~\cite{madduri2018reproducible}.


\subsection{External adoption of BDBag and Minid software}

GitHub provides us with some information about who is using our BDBag and Minid software,
in that we can search to see where the software is included in other public GitHub repositories. 
%This usage, plus the number who have ``starred" the BDBag repository, is a nice validation of the utility of the work. 
For example:

\begin{itemize}
\item
The BD2K BDDS project used BDBags and/or Minids in the following products: % developed within BDDS:
\begin{itemize}
\item
Encode2Bag client and service: \smallurl{https://github.com/ini-bdds/encode2bag} and 
\smallurl{https://github.com/ini-bdds/encode2bag-service}

\item
SOCR-Dashboard: \smallurl{https://github.com/BD2K/SOCR-Dashboard}

\item
Peptide Atlas: \smallurl{http://www.peptideatlas.org/}
\end{itemize}

\item
BD2K BDDS team participants have also integrated BDBags and Minids into other tools 
developed in part with resources external to BDDS:
\begin{itemize}
\item
The USC/ISI Discovery Environment for Relational Information and Versioned Assets (DERIVA) 
team uses BDBag and Minid for data import and export, enabling interoperability with other elements of the big biomedical data ecosystem. See \smallurl{http://isrd.isi.edu/deriva/} and \smallurl{https://github.com/informatics-isi-edu/deriva-py}.
\item
The UChicago team uses BDBags and Minids for data import and export within Globus Genomics 
(\smallurl{http://globusgenomics.org/}). See \smallurl{https://github.com/globusgenomics/genomics-footprint}.
\end{itemize}

\item
A number of groups external to BDDS are using BDBag and Minid technology in biomedical projects:
\begin{itemize}
\item
The NIDCR-funded Facebase resource (see \smallurl{https://www.facebase.org}) uses DERIVA, and hence BDBags and Minids, for data import and export.

\item
The Galaxy project (\smallurl{https://galaxyproject.org/}) is integrating BDBag and Minid support for data import and export. 
See \smallurl{https://github.com/galaxyproject/galaxy}.

\item
The Gene Ontology (\smallurl{http://geneontology.org/}) project is integrating BDBag and Minid support for data import and export.
See \smallurl{https://github.com/geneontology}.

\item
The Monarch Initiative (\smallurl{https://monarchinitiative.org} is evaluating BDBags for data import and export. See
\smallurl{https://github.com/monarch-initiative/dipper/issues/551}.

\item
The NIH National Center for Advancing Translational Research (NCATS) Data Translator team
(https://ncats.nih.gov/translator) uses BDBags
in its ``smart bag" technology. See 
\smallurl{https://github.com/NCATS-Tangerine/smartBag}.

\item
The University of Chicago Center for Data Intensive Science (CDIS) is considering 
BDBag and Minid for use within its Peregrine/IndexD, as a basis for interoperability with other elements
of the NIH Data Commons. \smallurl{https://github.com/uc-cdis/indexd} and \smallurl{https://github.com/uc-cdis/peregrine}
\end{itemize}

\item
BDBags and Minids are also being used outside biomedicine. For example, they are being integrated
into the Materials Data Facility (\smallurl{https://www.materialsdata facility}) as a standard format for data import and
export. 

\end{itemize}

\bibliographystyle{unsrt}
\bibliography{refs,minid}

\end{document}
